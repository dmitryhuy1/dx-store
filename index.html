<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DX / LAB Store</title>
<script src="https://integrationjs.tbank.ru/integration.js" defer></script>
<style>
body { background-color: black; color: white; font-family: 'Helvetica', sans-serif; margin: 0; overflow-x: hidden; }
.top-bar { position: fixed; top: 20px; left: 20px; right: 20px; display: flex; justify-content: space-between; font-weight: bold; letter-spacing: 5px; z-index: 2000; }
#intro { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background-color: black; display: flex; justify-content: center; align-items: center; z-index: 5000; transition: 0.8s; }
#intro.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
h1 { font-size: 6vw; text-transform: uppercase; cursor: pointer; transition: 0.5s; letter-spacing: 5px; }
h1:hover { letter-spacing: 15px; color: #ff3e00; }
#shop-content { padding: 120px 50px; display: none; grid-template-columns: repeat(3, 1fr); gap: 40px; min-height: 80vh; }
#shop-content.visible { display: grid; }
.product-card { cursor: pointer; transition: 0.3s; }
.product-card:hover { opacity: 0.8; }
.photo-main { width: 100%; aspect-ratio: 3/4; object-fit: cover; background: #1a1a1a; margin-bottom: 15px; }
#product-page { display: none; padding: 120px 50px; min-height: 80vh; }
#product-page.visible { display: block; }
.product-container { display: flex; gap: 50px; flex-wrap: wrap; }
.product-img-large { width: 50%; min-width: 300px; aspect-ratio: 3/4; object-fit: cover; background: #1a1a1a; }
.product-info { flex: 1; min-width: 300px; }
.size-picker { display: flex; gap: 10px; margin: 20px 0; }
.size-btn { border: 1px solid #333; background: none; color: white; padding: 10px 20px; cursor: pointer; }
.size-btn.active { background: white; color: black; }
.buy-btn { background: white; color: black; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
.buy-btn:active { opacity: 0.5; }
#cart-panel { position: fixed; top: 0; right: -400px; width: 350px; height: 100%; background: #111; z-index: 6000; transition: 0.4s; padding: 60px 20px; box-sizing: border-box; }
#cart-panel.open { right: 0; }
.cart-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #222; font-size: 14px; }
.remove-btn { background: none; border: none; color: #ff4444; cursor: pointer; font-size: 18px; padding: 0 10px; }
footer { background: #000; color: #666; padding: 60px 20px; border-top: 1px solid #222; margin-top: 50px; }
</style>
</head>
<body>

<div class="top-bar">
<span onclick="location.reload()" style="cursor:pointer">DX / LAB</span>
<span id="cart-btn" style="cursor:pointer">CART (<span id="cart-count">0</span>)</span>
</div>

<div id="intro">
<h1 onclick="startSite()">Start Shopping</h1>
</div>

<div id="cart-panel">
<h2 style="letter-spacing: 2px;">YOUR SELECTION</h2>
<div id="cart-items-list" style="margin-top: 30px;"></div>
<div id="cart-total" style="margin: 30px 0; font-weight: bold; border-top: 1px solid #333; padding-top: 20px;">TOTAL: 0 ₽</div>
<button class="buy-btn" id="checkout-btn" onclick="handleCheckout()">CHECKOUT</button>
<p onclick="clearCart()" style="text-align:center; cursor:pointer; opacity:0.5; font-size:12px; margin-top: 20px;">CLEAR ALL</p>
<p onclick="toggleCart()" style="text-align:center; cursor:pointer; margin-top:20px; opacity:0.3; text-transform: uppercase; font-size: 10px;">CLOSE</p>
</div>

<main id="shop-content"></main>

<div id="product-page">
<div onclick="goBack()" style="cursor:pointer; margin-bottom:20px; opacity:0.5;">← BACK</div>
<div class="product-container">
<img id="detail-img" class="product-img-large">
<div class="product-info">
<h2 id="detail-title" style="font-size:3rem; margin:0; text-transform: uppercase;"></h2>
<p id="detail-price" style="font-size:1.5rem; color:#888; margin:10px 0;"></p>
<div class="size-picker" id="detail-sizes"></div>
<button class="buy-btn" onclick="addCurrentToCart()">ADD TO CART</button>
<div style="margin-top:40px; border-top:1px solid #333; padding-top:20px;">
<h3 style="font-size: 12px; letter-spacing: 2px;">DESCRIPTION</h3>
<p id="detail-desc" style="line-height:1.6; color: #888; font-size: 14px;"></p>
</div>
</div>
</div>
</div>

<footer>
<p style="text-align: center; font-size: 11px;">ИП Пыхов Дмитрий Артемович | © 2026 DX / LAB STORE</p>
</footer>

<script>
const products = [
{ id: 1, name: 'DX Bomber', price: 5990, img: 'images/1.jpg', desc: 'Premium bomber jacket.', sizes: ['S', 'M', 'L'] },
{ id: 2, name: 'LAB Cargo', price: 12000, img: 'images/2.jpg', desc: 'Tactical cargo pants.', sizes: ['M', 'L', 'XL'] },
{ id: 3, name: 'Basic Tee', price: 5000, img: 'images/3.jpg', desc: 'Heavy cotton t-shirt.', sizes: ['S', 'M', 'L'] }
];

let cart = JSON.parse(localStorage.getItem('dx_cart')) || [];
let currentProductId = null;
let selectedSize = null;

const TERMINAL_KEY = '176967341';
const TG_TOKEN = '8433870657:AAGPGqsm2hiaJlMEs-j2pgLnPwm71U3_x4U';
const TG_CHAT_ID = '6460754612';

// Инициализация при загрузке
window.onload = () => {
if (typeof PaymentIntegration !== 'undefined') {
PaymentIntegration.init({
terminalKey: TERMINAL_KEY,
product: 'eacq',
features: { payment: { config: { status: { changedCallback: (s) => { if(s==='SUCCESS') sendFinalNotification(); } } } } }
});
}
};

function startSite() {
document.getElementById('intro').classList.add('hidden');
document.getElementById('shop-content').classList.add('visible');
renderShop();
}

function renderShop() {
const shop = document.getElementById('shop-content');
shop.innerHTML = products.map(p => `
<div class="product-card" onclick="openProduct(${p.id})">
<img src="${p.img}" class="photo-main" onerror="this.src='https://via.placeholder.com/300x400?text=No+Photo'">
<h3>${p.name}</h3>
<p style="color: #888;">${p.price} ₽</p>
</div>
`).join('');
}

function openProduct(id) {
const p = products.find(item => item.id === id);
currentProductId = id;
selectedSize = null;
document.getElementById('shop-content').classList.remove('visible');
document.getElementById('product-page').classList.add('visible');
document.getElementById('detail-img').src = p.img;
document.getElementById('detail-title').innerText = p.name;
document.getElementById('detail-price').innerText = p.price + ' ₽';
document.getElementById('detail-desc').innerText = p.desc;
document.getElementById('detail-sizes').innerHTML = p.sizes.map(s =>
`<button class="size-btn" onclick="selectSize(this, '${s}')">${s}</button>`).join('');
window.scrollTo(0,0);
}

function selectSize(btn, size) {
document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
btn.classList.add('active');
selectedSize = size;
}

function goBack() {
document.getElementById('product-page').classList.remove('visible');
document.getElementById('shop-content').classList.add('visible');
}

function addCurrentToCart() {
if (!selectedSize) { alert('Please select a size'); return; }
const p = products.find(item => item.id === currentProductId);
cart.push({ name: p.name, size: selectedSize, price: p.price });
updateCartUI();
toggleCart();
}

function toggleCart() { document.getElementById('cart-panel').classList.toggle('open'); }
document.getElementById('cart-btn').onclick = toggleCart;

function updateCartUI() {
const list = document.getElementById('cart-items-list');
const count = document.getElementById('cart-count');
const totalDiv = document.getElementById('cart-total');
count.innerText = cart.length;
let total = 0;
if (cart.length === 0) {
list.innerHTML = '<p style="text-align:center; opacity:0.3; padding:20px; font-size: 12px;">CART IS EMPTY</p>';
} else {
list.innerHTML = cart.map((item, i) => {
total += item.price;
return `<div class="cart-item"><span>${item.name} (${item.size})<br>${item.price} ₽</span><button onclick="removeFromCart(${i})" class="remove-btn">✕</button></div>`;
}).join('');
}
totalDiv.innerText = 'TOTAL: ' + total + ' ₽';
localStorage.setItem('dx_cart', JSON.stringify(cart));
}

function removeFromCart(index) {
cart.splice(index, 1);
updateCartUI();
}

function clearCart() {
if (cart.length > 0 && confirm("Clear all items?")) {
cart = [];
updateCartUI();
}
}

// НОВАЯ ЛОГИКА КЛИКА
function handleCheckout() {
console.log("Кнопка нажата");
if (cart.length === 0) {
alert("Корзина пуста!");
return;
}

if (typeof PaymentIntegration === 'undefined') {
alert("Скрипт банка еще загружается, подождите секунду...");
return;
}

let total = 0;
cart.forEach(item => total += item.price);

PaymentIntegration.open({
terminalKey: TERMINAL_KEY,
amount: total,
orderId: 'DX_' + Date.now(),
description: 'Order DX / LAB'
}).catch(err => {
console.error(err);
alert("Ошибка: проверьте настройки терминала.");
});
}

async function sendFinalNotification() {
let message = "✅ ОПЛАЧЕН НОВЫЙ ЗАКАЗ!\n\n";
cart.forEach((item, i) => {
message += (i + 1) + ". " + item.name + " (" + item.size + ") - " + item.price + " ₽\n";
});
await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ chat_id: TG_CHAT_ID, text: message })
});
cart = [];
updateCartUI();
toggleCart();
alert("Оплата принята!");
}

updateCartUI();
</script>
</body>
</html>
